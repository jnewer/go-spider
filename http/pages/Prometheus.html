<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">Prometheus</h1>                                <a target="_blank" rel="noopener" href="https://translate.gorm.io/project/go-gorm/zh-CN" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><p>GORM 提供了 Prometheus 插件来收集 <a target="_blank" rel="noopener" href="https://pkg.go.dev/database/sql?tab=doc#DBStats">DBStats</a> 和用户自定义指标</p><p><a target="_blank" rel="noopener" href="https://github.com/go-gorm/prometheus">https://github.com/go-gorm/prometheus</a></p><h2 id="用法" class="article-heading"><a href="#用法" class="headerlink" title="用法"></a>用法<a class="article-anchor" href="#用法" aria-hidden="true"></a></h2><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"gorm.io/gorm"</span></span><br><span class="line">  <span class="string">"gorm.io/driver/sqlite"</span></span><br><span class="line">  <span class="string">"gorm.io/plugin/prometheus"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{})</span><br><span class="line"></span><br><span class="line">db.Use(prometheus.New(prometheus.Config{</span><br><span class="line">  DBName:          <span class="string">"db1"</span>, <span class="comment">// 使用 `DBName` 作为指标 label</span></span><br><span class="line">  RefreshInterval: <span class="number">15</span>,    <span class="comment">// 指标刷新频率（默认为 15 秒）</span></span><br><span class="line">  PushAddr:        <span class="string">"prometheus pusher address"</span>, <span class="comment">// 如果配置了 `PushAddr`，则推送指标</span></span><br><span class="line">  StartServer:     <span class="literal">true</span>,  <span class="comment">// 启用一个 http 服务来暴露指标</span></span><br><span class="line">  HTTPServerPort:  <span class="number">8080</span>,  <span class="comment">// 配置 http 服务监听端口，默认端口为 8080 （如果您配置了多个，只有第一个 `HTTPServerPort` 会被使用）</span></span><br><span class="line">  MetricsCollector: []prometheus.MetricsCollector {</span><br><span class="line">    &amp;prometheus.MySQL{</span><br><span class="line">      VariableNames: []<span class="type">string</span>{<span class="string">"Threads_running"</span>},</span><br><span class="line">    },</span><br><span class="line">  },  <span class="comment">// 用户自定义指标</span></span><br><span class="line">}))</span><br></pre></td></tr></tbody></table></figure><h2 id="用户自定义指标" class="article-heading"><a href="#用户自定义指标" class="headerlink" title="用户自定义指标"></a>用户自定义指标<a class="article-anchor" href="#用户自定义指标" aria-hidden="true"></a></h2><p>您可以通过 GORM Prometheus 插件定义并收集自定义的指标，这需要实现 <code>MetricCollector</code> 接口</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> MetricsCollector <span class="keyword">interface</span> {</span><br><span class="line">  Metrics(*Prometheus) []prometheus.Collector</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="MySQL" class="article-heading"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL<a class="article-anchor" href="#MySQL" aria-hidden="true"></a></h3><p>GORM 提供了一个示例，说明如何收集 MySQL 状态指标，查看 <a target="_blank" rel="noopener" href="https://github.com/go-gorm/prometheus/blob/master/mysql.go">prometheus.MySQL</a> 获取详情</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">&amp;prometheus.MySQL{</span><br><span class="line">  <span class="comment">// 指标名前缀，默认为 `gorm_status_`</span></span><br><span class="line">  <span class="comment">// 例如： Threads_running 的指标名就是 `gorm_status_Threads_running`</span></span><br><span class="line">  Prefix: <span class="string">"gorm_status_"</span>,</span><br><span class="line">  <span class="comment">// 拉取频率，默认使用 Prometheus 的 RefreshInterval</span></span><br><span class="line">  Interval: <span class="number">100</span>,</span><br><span class="line">  <span class="comment">// 从 SHOW STATUS 选择变量变量，如果不设置，则使用全部的状态变量</span></span><br><span class="line">  VariableNames: []<span class="type">string</span>{<span class="string">"Threads_running"</span>},</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></body></html>              </div>                            <div>