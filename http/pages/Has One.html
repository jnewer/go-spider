<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">Has One</h1>                                <a target="_blank" rel="noopener" href="https://translate.gorm.io/project/go-gorm/zh-CN" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><h2 id="Has-One" class="article-heading"><a href="#Has-One" class="headerlink" title="Has One"></a>Has One<a class="article-anchor" href="#Has-One" aria-hidden="true"></a></h2><p><code>has one</code> 与另一个模型建立一对一的关联，但它和一对一关系有些许不同。 这种关联表明一个模型的每个实例都包含或拥有另一个模型的一个实例。</p><p>例如，您的应用包含 user 和 credit card 模型，且每个 user 只能有一张 credit card。</p><h3 id="Declare" class="article-heading"><a href="#Declare" class="headerlink" title="Declare"></a>Declare<a class="article-anchor" href="#Declare" aria-hidden="true"></a></h3><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// User 有一张 CreditCard，UserID 是外键</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  CreditCard CreditCard</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Number <span class="type">string</span></span><br><span class="line">  UserID <span class="type">uint</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Retrieve" class="article-heading"><a href="#Retrieve" class="headerlink" title="Retrieve"></a>Retrieve<a class="article-anchor" href="#Retrieve" aria-hidden="true"></a></h3><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Retrieve user list with eager loading credit card</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetAll</span><span class="params">(db *gorm.DB)</span></span> ([]User, <span class="type">error</span>) {</span><br><span class="line">    <span class="keyword">var</span> users []User</span><br><span class="line">    err := db.Model(&amp;User{}).Preload(<span class="string">"CreditCard"</span>).Find(&amp;users).Error</span><br><span class="line">    <span class="keyword">return</span> users, err</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="重写外键" class="article-heading"><a href="#重写外键" class="headerlink" title="重写外键"></a>重写外键<a class="article-anchor" href="#重写外键" aria-hidden="true"></a></h2><p>对于 <code>has one</code> 关系，同样必须存在外键字段。拥有者将把属于它的模型的主键保存到这个字段。</p><p>这个字段的名称通常由 <code>has one</code> 模型的类型加上其 <code>主键</code> 生成，对于上面的例子，它是 <code>UserID</code>。</p><p>为 user 添加 credit card 时，它会将 user 的 <code>ID</code> 保存到自己的 <code>UserID</code> 字段。</p><p>如果你想要使用另一个字段来保存该关系，你同样可以使用标签 <code>foreignKey</code> 来更改它，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  CreditCard CreditCard <span class="string">`gorm:"foreignKey:UserName"`</span></span><br><span class="line">  <span class="comment">// use UserName as foreign key</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Number   <span class="type">string</span></span><br><span class="line">  UserName <span class="type">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="重写引用" class="article-heading"><a href="#重写引用" class="headerlink" title="重写引用"></a>重写引用<a class="article-anchor" href="#重写引用" aria-hidden="true"></a></h2><p>默认情况下，拥有者实体会将 <code>has one</code> 对应模型的主键保存为外键，您也可以修改它，用另一个字段来保存，例如下个这个使用 <code>Name</code> 来保存的例子。</p><p>您可以使用标签 <code>references</code> 来更改它，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Name       <span class="type">string</span>     <span class="string">`gorm:"index"`</span></span><br><span class="line">  CreditCard CreditCard <span class="string">`gorm:"foreignkey:UserName;references:name"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Number   <span class="type">string</span></span><br><span class="line">  UserName <span class="type">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="多态关联" class="article-heading"><a href="#多态关联" class="headerlink" title="多态关联"></a>多态关联<a class="article-anchor" href="#多态关联" aria-hidden="true"></a></h2><p>GORM 为 <code>has one</code> 和 <code>has many</code> 提供了多态关联支持，它会将拥有者实体的表名、主键值都保存到多态类型的字段中。</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> {</span><br><span class="line">  ID    <span class="type">int</span></span><br><span class="line">  Name  <span class="type">string</span></span><br><span class="line">  Toy   Toy <span class="string">`gorm:"polymorphic:Owner;"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> {</span><br><span class="line">  ID   <span class="type">int</span></span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Toy  Toy <span class="string">`gorm:"polymorphic:Owner;"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Toy <span class="keyword">struct</span> {</span><br><span class="line">  ID        <span class="type">int</span></span><br><span class="line">  Name      <span class="type">string</span></span><br><span class="line">  OwnerID   <span class="type">int</span></span><br><span class="line">  OwnerType <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">db.Create(&amp;Dog{Name: <span class="string">"dog1"</span>, Toy: Toy{Name: <span class="string">"toy1"</span>}})</span><br><span class="line"><span class="comment">// INSERT INTO `dogs` (`name`) VALUES ("dog1")</span></span><br><span class="line"><span class="comment">// INSERT INTO `toys` (`name`,`owner_id`,`owner_type`) VALUES ("toy1","1","dogs")</span></span><br></pre></td></tr></tbody></table></figure><p>您可以使用标签 <code>polymorphicValue</code> 来更改多态类型的值，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> {</span><br><span class="line">  ID   <span class="type">int</span></span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Toy  Toy <span class="string">`gorm:"polymorphic:Owner;polymorphicValue:master"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Toy <span class="keyword">struct</span> {</span><br><span class="line">  ID        <span class="type">int</span></span><br><span class="line">  Name      <span class="type">string</span></span><br><span class="line">  OwnerID   <span class="type">int</span></span><br><span class="line">  OwnerType <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">db.Create(&amp;Dog{Name: <span class="string">"dog1"</span>, Toy: Toy{Name: <span class="string">"toy1"</span>}})</span><br><span class="line"><span class="comment">// INSERT INTO `dogs` (`name`) VALUES ("dog1")</span></span><br><span class="line"><span class="comment">// INSERT INTO `toys` (`name`,`owner_id`,`owner_type`) VALUES ("toy1","1","master")</span></span><br></pre></td></tr></tbody></table></figure><h2 id="Has-One-的-CURD" class="article-heading"><a href="#Has-One-的-CURD" class="headerlink" title="Has One 的 CURD"></a>Has One 的 CURD<a class="article-anchor" href="#Has-One-的-CURD" aria-hidden="true"></a></h2><p>查看 <a href="associations.html#Association-Mode">关联模式</a> 获取 <code>has one</code> 相关的用法</p><h2 id="预加载" class="article-heading"><a href="#预加载" class="headerlink" title="预加载"></a>预加载<a class="article-anchor" href="#预加载" aria-hidden="true"></a></h2><p>GORM 可以通过 <code>Preload</code>、<code>Joins</code> 预加载 <code>has one</code> 关联的记录，查看 <a href="preload.html">预加载</a> 获取详情</p><h2 id="自引用-Has-One" class="article-heading"><a href="#自引用-Has-One" class="headerlink" title="自引用 Has One"></a>自引用 Has One<a class="article-anchor" href="#自引用-Has-One" aria-hidden="true"></a></h2><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Name      <span class="type">string</span></span><br><span class="line">  ManagerID *<span class="type">uint</span></span><br><span class="line">  Manager   *User</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="外键约束" class="article-heading"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束<a class="article-anchor" href="#外键约束" aria-hidden="true"></a></h2><p>你可以通过为标签 <code>constraint</code> 配置 <code>OnUpdate</code>、<code>OnDelete</code> 实现外键约束，在使用 GORM 进行迁移时它会被创建，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  CreditCard CreditCard <span class="string">`gorm:"constraint:OnUpdate:CASCADE,OnDelete:SET NULL;"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  Number <span class="type">string</span></span><br><span class="line">  UserID <span class="type">uint</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>你也可以在删除记录时通过 <code>Select</code> 来删除关联的记录，查看 <a href="associations.html#delete_with_select">Delete with Select</a> 获取详情</p></body></html>              </div>                            <div>