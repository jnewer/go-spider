<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">约定</h1>                                <a target="_blank" rel="noopener" href="https://translate.gorm.io/project/go-gorm/zh-CN" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><h2 id="使用-ID-作为主键" class="article-heading"><a href="#使用-ID-作为主键" class="headerlink" title="使用 ID 作为主键"></a>使用 <code>ID</code> 作为主键<a class="article-anchor" href="#使用-ID-作为主键" aria-hidden="true"></a></h2><p>默认情况下，GORM 会使用 <code>ID</code> 作为表的主键。</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp; ID &nbsp; <span class="type">string</span> <span class="comment">// 默认情况下，名为 `ID` 的字段会作为表的主键</span></span><br><span class="line">&nbsp; Name <span class="type">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>你可以通过标签 <code>primaryKey</code> 将其它字段设为主键</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 将 `UUID` 设为主键</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> {</span><br><span class="line">&nbsp; ID &nbsp; &nbsp; <span class="type">int64</span></span><br><span class="line">&nbsp; UUID &nbsp; <span class="type">string</span> <span class="string">`gorm:"primaryKey"`</span></span><br><span class="line">&nbsp; Name &nbsp; <span class="type">string</span></span><br><span class="line">&nbsp; Age &nbsp; &nbsp;<span class="type">int64</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>此外，您还可以看看 <a href="composite_primary_key.html">复合主键</a></p><h2 id="复数表名" class="article-heading"><a href="#复数表名" class="headerlink" title="复数表名"></a>复数表名<a class="article-anchor" href="#复数表名" aria-hidden="true"></a></h2><p>GORM 使用结构体名的 <code>蛇形命名</code> 作为表名。对于结构体 <code>User</code>，根据约定，其表名为 <code>users</code></p><h3 id="TableName" class="article-heading"><a href="#TableName" class="headerlink" title="TableName"></a>TableName<a class="article-anchor" href="#TableName" aria-hidden="true"></a></h3><p>您可以实现 <code>Tabler</code> 接口来更改默认表名，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Tabler <span class="keyword">interface</span> {</span><br><span class="line">    TableName() <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableName 会将 User 的表名重写为 `profiles`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> TableName() <span class="type">string</span> {</span><br><span class="line">&nbsp; <span class="keyword">return</span> <span class="string">"profiles"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote class="note warn"><p><strong>注意：</strong> <code>TableName</code> 不支持动态变化，它会被缓存下来以便后续使用。想要使用动态表名，你可以使用 <code>Scopes</code>，例如：</p></blockquote><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserTable</span><span class="params">(user User)</span></span> <span class="function"><span class="keyword">func</span> <span class="params">(tx *gorm.DB)</span></span> *gorm.DB {</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">(tx *gorm.DB)</span></span> *gorm.DB {</span><br><span class="line">    <span class="keyword">if</span> user.Admin {</span><br><span class="line">      <span class="keyword">return</span> tx.Table(<span class="string">"admin_users"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tx.Table(<span class="string">"users"</span>)</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">db.Scopes(UserTable(user)).Create(&amp;user)</span><br></pre></td></tr></tbody></table></figure><h3 id="临时指定表名" class="article-heading"><a href="#临时指定表名" class="headerlink" title="临时指定表名"></a>临时指定表名<a class="article-anchor" href="#临时指定表名" aria-hidden="true"></a></h3><p>您可以使用 <code>Table</code> 方法临时指定表名，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 根据 User 的字段创建 `deleted_users` 表</span></span><br><span class="line">db.Table(<span class="string">"deleted_users"</span>).AutoMigrate(&amp;User{})</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从另一张表查询数据</span></span><br><span class="line"><span class="keyword">var</span> deletedUsers []User</span><br><span class="line">db.Table(<span class="string">"deleted_users"</span>).Find(&amp;deletedUsers)</span><br><span class="line"><span class="comment">// SELECT * FROM deleted_users;</span></span><br><span class="line"></span><br><span class="line">db.Table(<span class="string">"deleted_users"</span>).Where(<span class="string">"name = ?"</span>, <span class="string">"jinzhu"</span>).Delete(&amp;User{})</span><br><span class="line"><span class="comment">// DELETE FROM deleted_users WHERE name = 'jinzhu';</span></span><br></pre></td></tr></tbody></table></figure><p>查看 <a href="advanced_query.html#from_subquery">from 子查询</a> 了解如何在 FROM 子句中使用子查询</p><h3 id="命名策略" class="article-heading"><a href="#命名策略" class="headerlink" title="命名策略"></a><span id="naming_strategy">命名策略</span><a class="article-anchor" href="#命名策略" aria-hidden="true"></a></h3><p>GORM 允许用户通过覆盖默认的<code>命名策略</code>更改默认的命名约定，命名策略被用于构建： <code>TableName</code>、<code>ColumnName</code>、<code>JoinTableName</code>、<code>RelationshipFKName</code>、<code>CheckerName</code>、<code>IndexName</code>。查看 <a href="gorm_config.html#naming_strategy">GORM 配置</a> 获取详情</p><h2 id="列名" class="article-heading"><a href="#列名" class="headerlink" title="列名"></a>列名<a class="article-anchor" href="#列名" aria-hidden="true"></a></h2><p>根据约定，数据表的列名使用的是 struct 字段名的 <code>蛇形命名</code></p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">&nbsp; ID &nbsp; &nbsp; &nbsp; &nbsp;<span class="type">uint</span> &nbsp; &nbsp; &nbsp;<span class="comment">// 列名是 `id`</span></span><br><span class="line">&nbsp; Name &nbsp; &nbsp; &nbsp;<span class="type">string</span> &nbsp; &nbsp;<span class="comment">// 列名是 `name`</span></span><br><span class="line">&nbsp; Birthday &nbsp;time.Time <span class="comment">// 列名是 `birthday`</span></span><br><span class="line">&nbsp; CreatedAt time.Time <span class="comment">// 列名是 `created_at`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>您可以使用 <code>column</code> 标签或 <a href="#naming_strategy"><code>命名策略</code></a> 来覆盖列名</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> {</span><br><span class="line">&nbsp; AnimalID <span class="type">int64</span> &nbsp; &nbsp; <span class="string">`gorm:"column:beast_id"`</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="comment">// 将列名设为 `beast_id`</span></span><br><span class="line">&nbsp; Birthday time.Time <span class="string">`gorm:"column:day_of_the_beast"`</span> <span class="comment">// 将列名设为 `day_of_the_beast`</span></span><br><span class="line">&nbsp; Age &nbsp; &nbsp; &nbsp;<span class="type">int64</span> &nbsp; &nbsp; <span class="string">`gorm:"column:age_of_the_beast"`</span> <span class="comment">// 将列名设为 `age_of_the_beast`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="时间戳追踪" class="article-heading"><a href="#时间戳追踪" class="headerlink" title="时间戳追踪"></a>时间戳追踪<a class="article-anchor" href="#时间戳追踪" aria-hidden="true"></a></h2><h3 id="CreatedAt" class="article-heading"><a href="#CreatedAt" class="headerlink" title="CreatedAt"></a>CreatedAt<a class="article-anchor" href="#CreatedAt" aria-hidden="true"></a></h3><p>对于有 <code>CreatedAt</code> 字段的模型，创建记录时，如果该字段值为零值，则将该字段的值设为当前时间</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db.Create(&amp;user) <span class="comment">// 将 `CreatedAt` 设为当前时间</span></span><br><span class="line"></span><br><span class="line">user2 := User{Name: <span class="string">"jinzhu"</span>, CreatedAt: time.Now()}</span><br><span class="line">db.Create(&amp;user2) <span class="comment">// user2 的 `CreatedAt` 不会被修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 想要修改该值，您可以使用 `Update`</span></span><br><span class="line">db.Model(&amp;user).Update(<span class="string">"CreatedAt"</span>, time.Now())</span><br></pre></td></tr></tbody></table></figure><p>You can disable the timestamp tracking by setting <code>autoCreateTime</code> tag to <code>false</code>, for example:</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  CreatedAt time.Time <span class="string">`gorm:"autoCreateTime:false"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="UpdatedAt" class="article-heading"><a href="#UpdatedAt" class="headerlink" title="UpdatedAt"></a>UpdatedAt<a class="article-anchor" href="#UpdatedAt" aria-hidden="true"></a></h3><p>For models having <code>UpdatedAt</code> field, the field will be set to the current time when the record is updated or created if its value is zero</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db.Save(&amp;user) <span class="comment">// set `UpdatedAt` to current time</span></span><br><span class="line"></span><br><span class="line">db.Model(&amp;user).Update(<span class="string">"name"</span>, <span class="string">"jinzhu"</span>) <span class="comment">// will set `UpdatedAt` to current time</span></span><br><span class="line"></span><br><span class="line">db.Model(&amp;user).UpdateColumn(<span class="string">"name"</span>, <span class="string">"jinzhu"</span>) <span class="comment">// `UpdatedAt` won't be changed</span></span><br><span class="line"></span><br><span class="line">user2 := User{Name: <span class="string">"jinzhu"</span>, UpdatedAt: time.Now()}</span><br><span class="line">db.Create(&amp;user2) <span class="comment">// user2's `UpdatedAt` won't be changed when creating</span></span><br><span class="line"></span><br><span class="line">user3 := User{Name: <span class="string">"jinzhu"</span>, UpdatedAt: time.Now()}</span><br><span class="line">db.Save(&amp;user3) <span class="comment">// user3's `UpdatedAt` will change to current time when updating</span></span><br></pre></td></tr></tbody></table></figure><p>You can disable the timestamp tracking by setting <code>autoUpdateTime</code> tag to <code>false</code>, for example:</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  UpdatedAt time.Time <span class="string">`gorm:"autoUpdateTime:false"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote class="note undefined"><p><strong>NOTE</strong> GORM supports having multiple time tracking fields and track with UNIX (nano/milli) seconds, checkout <a href="models.html#time_tracking">Models</a> for more details</p></blockquote></body></html>              </div>                            <div>