<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">数据库索引</h1>                                <a target="_blank" rel="noopener" href="https://translate.gorm.io/project/go-gorm/zh-CN" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><p>GORM 允许通过 <code>index</code>、<code>uniqueIndex</code> 标签创建索引，这些索引将在使用 GORM 进行<a href="migration.html">AutoMigrate 或 Createtable </a> 时创建</p><h2 id="索引标签" class="article-heading"><a href="#索引标签" class="headerlink" title="索引标签"></a>索引标签<a class="article-anchor" href="#索引标签" aria-hidden="true"></a></h2><p>GORM 可以接受很多索引设置，例如<code>class</code>、<code>type</code>、<code>where</code>、<code>comment</code>、<code>expression</code>、<code>sort</code>、<code>collate</code>、<code>option</code></p><p>下面的示例演示了如何使用它：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name  <span class="type">string</span> <span class="string">`gorm:"index"`</span></span><br><span class="line">    Name2 <span class="type">string</span> <span class="string">`gorm:"index:idx_name,unique"`</span></span><br><span class="line">    Name3 <span class="type">string</span> <span class="string">`gorm:"index:,sort:desc,collate:utf8,type:btree,length:10,where:name3 != 'jinzhu'"`</span></span><br><span class="line">    Name4 <span class="type">string</span> <span class="string">`gorm:"uniqueIndex"`</span></span><br><span class="line">    Age   <span class="type">int64</span>  <span class="string">`gorm:"index:,class:FULLTEXT,comment:hello \\, world,where:age &gt; 10"`</span></span><br><span class="line">    Age2  <span class="type">int64</span>  <span class="string">`gorm:"index:,expression:ABS(age)"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// MySQL 选项</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`gorm:"index:,class:FULLTEXT,option:WITH PARSER ngram INVISIBLE"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// PostgreSQL 选项</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`gorm:"index:,option:CONCURRENTLY"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="唯一索引" class="article-heading"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引<a class="article-anchor" href="#唯一索引" aria-hidden="true"></a></h3><p><code>uniqueIndex</code> 标签的作用与 <code>index</code> 类似，它等效于 <code>index:,unique</code></p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name1 <span class="type">string</span> <span class="string">`gorm:"uniqueIndex"`</span></span><br><span class="line">    Name2 <span class="type">string</span> <span class="string">`gorm:"uniqueIndex:idx_name,sort:desc"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="复合索引" class="article-heading"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引<a class="article-anchor" href="#复合索引" aria-hidden="true"></a></h2><p>两个字段使用同一个索引名将创建复合索引，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// create composite index `idx_member` with columns `name`, `number`</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`gorm:"index:idx_member"`</span></span><br><span class="line">    Number <span class="type">string</span> <span class="string">`gorm:"index:idx_member"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="字段优先级" class="article-heading"><a href="#字段优先级" class="headerlink" title="字段优先级"></a>字段优先级<a class="article-anchor" href="#字段优先级" aria-hidden="true"></a></h3><p>复合索引列的顺序会影响其性能，因此必须仔细考虑</p><p>您可以使用 <code>priority</code> 指定顺序，默认优先级值是 <code>10</code>，如果优先级值相同，则顺序取决于模型结构体字段的顺序</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`gorm:"index:idx_member"`</span></span><br><span class="line">    Number <span class="type">string</span> <span class="string">`gorm:"index:idx_member"`</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// column order: name, number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`gorm:"index:idx_member,priority:2"`</span></span><br><span class="line">    Number <span class="type">string</span> <span class="string">`gorm:"index:idx_member,priority:1"`</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// column order: number, name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`gorm:"index:idx_member,priority:12"`</span></span><br><span class="line">    Number <span class="type">string</span> <span class="string">`gorm:"index:idx_member"`</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// column order: number, name</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Shared-composite-indexes" class="article-heading"><a href="#Shared-composite-indexes" class="headerlink" title="Shared composite indexes"></a>Shared composite indexes<a class="article-anchor" href="#Shared-composite-indexes" aria-hidden="true"></a></h3><p>If you are creating shared composite indexes with an embedding struct, you can’t specify the index name, as embedding the struct more than once results in the duplicated index name in db.</p><p>In this case, you can use index tag <code>composite</code>, it means the id of the composite index. All fields which have the same composite id of the struct are put together to the same index, just like the original rule. But the improvement is it lets the most derived/embedding struct generates the name of index by NamingStrategy. For example:</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> {</span><br><span class="line">  IndexA <span class="type">int</span> <span class="string">`gorm:"index:,unique,composite:myname"`</span></span><br><span class="line">  IndexB <span class="type">int</span> <span class="string">`gorm:"index:,unique,composite:myname"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>If the table Foo is created, the name of composite index will be <code>idx_foo_myname</code>.</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Bar0 <span class="keyword">struct</span> {</span><br><span class="line">  Foo</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Bar1 <span class="keyword">struct</span> {</span><br><span class="line">  Foo</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Respectively, the name of composite index is <code>idx_bar0_myname</code> and <code>idx_bar1_myname</code>.</p><p><code>composite</code> only works if not specify the name of index.</p><h2 id="多索引" class="article-heading"><a href="#多索引" class="headerlink" title="多索引"></a>多索引<a class="article-anchor" href="#多索引" aria-hidden="true"></a></h2><p>A field accepts multiple <code>index</code>, <code>uniqueIndex</code> tags that will create multiple indexes on a field</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UserIndex <span class="keyword">struct</span> {</span><br><span class="line">    OID          <span class="type">int64</span>  <span class="string">`gorm:"index:idx_id;index:idx_oid,unique"`</span></span><br><span class="line">    MemberNumber <span class="type">string</span> <span class="string">`gorm:"index:idx_id"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></body></html>              </div>                            <div>